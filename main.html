<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Verifying...</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
      const games = ["tame"];
      //const games = [
      //  "craft",
      //  "enchantment",
      //  "blocks",
      //  "arrange",
      //  "pick",
      //  "nameblock",
      //  "smelt",
      //  "tame",
      //];

      let currentPopup = null;
      const captchaBtn = document.querySelector(".sqr-captcha");

      function openCaptcha() {
        if (currentPopup && !currentPopup.closed) {
          currentPopup.focus();
          return;
        }

        const chosen = games[Math.floor(Math.random() * games.length)];

        currentPopup = window.open(
          chosen,
          "miniGame",
          "width=600,height=600,resizable=no,scrollbars=no",
        );
      }

      // Listen to messages from popup
      window.addEventListener("message", (event) => {
        if (!event.data || !event.data.type) return;

        if (event.data.type === "CRAFTCHA_PASS") {
          alert("Verification successful!");

          // Update button color immediately
          captchaBtn.style.backgroundColor = "yellow";

          // Optional: close popup if still open
          if (currentPopup && !currentPopup.closed) currentPopup.close();
          currentPopup = null;
        }
      });
    </script>
  </head>

  <body class="body-loader">
    <div class="page">
      <div class="card">
        <h1 class="title">Sign In</h1>

        <form class="form">
          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" required />
          </div>

          <div class="field">
            <label for="password">Password</label>
            <input id="password" type="password" minlength="6" required />
          </div>

          <button type="submit" class="btn">Sign In</button>
        </form>

        <p class="switch-text">
          Don’t have an account?
          <button type="button" class="link-btn">Sign Up</button>
        </p>

        <div class="captcha-container">
          <button
            type="button"
            class="sqr-captcha"
            onclick="openCaptcha()"
          ></button>
          <p>I hereby certify that I ain't no clanker.</p>
        </div>
      </div>
    </div>

    <!-- ✅ CAPTCHA OVERLAY (TOP LEVEL) -->
    <div id="captchaOverlay" class="captcha-overlay hidden">
      <iframe id="captchaFrame" title="Craftcha"></iframe>
    </div>
  </body>
</html>
